# 文档是沟通的中间件

最近Paddle的开源将我们的工作放到了网上，其实也把我们的工作方式改变了。以前我们整体上，沟通基本靠吼，但是现在基本上要将所有的沟通全部切换到github上。这个事情也是极大的改变了我们的工作流程。从入职到现在我们的工作流程也有了几次改变，这些改变也是随着团队规模的变化而变化的。这个事情对我的触动还是非常大的，原来我们团队的各种各样的沟通问题，可以通过这么简单的思路来解决。这里把我的一些想法梳理一下，相信很多其他工程团队的同事，也都是要经历一样的流程。

## Paddle团队经历的几次沟通方式变革

### 从0到1的封闭开发

由于我来Paddle Team的时间并不很早。这个封闭开发的时期我也没有赶上。不过估计当时就是大家都被关在一个小黑屋里，从早到晚只有这一个工作。这个阶段自然没有什么特别严重的沟通问题。因为抬头就能看见别人。同时，这个阶段最重要的任务就是快。文档什么的也并不重要。

### 小团队时期

这个阶段，Paddle Team大概也就只有3-4人。整体的工作流程大约是这样子的。


<details> 
<summary></summary>

![small team](https://g.gravizo.com/source/svg?https://gist.githubusercontent.com/reyoung/d976f3c8b1a081eb0b2e6ae02dd8213e/raw/829511efb9da13b2708a3fdde038292cbe7e0ff3/g1.dot)

这个阶段我们Paddle主要是一些维护工作，和follow新的论文，新的进展。有一个主要的leader A，然后这个A通知大家我们下一步要做什么，什么是有意义的。然后每一个人只和A讨论我们的工作进展，工作内容等等。

这在小团队的时候非常好用，因为沟通速度快。一般作为Leader A的能力也是很强的，威望也很高。他可以很简单的和大家沟通。假设每个人沟通一个小时一天，那么其实Leader A在上午来公司的时候，和每个人聊一聊也就搞定了。下午Leader A也可以潜心干自己的事情。

### 中型团队时期

然而，小团队总是不太可能一直维持的。因为我们在做一个特别有意义啊工作。所以新的事情会越来越多。事情多了自然会有新的人融进来。当团队变成7-8人的时候，小团队的工作状态就已经不合适了。

之前和一些其他部门的同事聊天，大家基本上说，团队到了7-8人就到头了。因为最后新加入的人沟通成本太高，我们根本没办法把精力放到工作上。白天上班开会，晚上加班回家写代码的惨剧就发生了。为什么会这个样子呢？因为我们的沟通模式没有变化。

![middle team](https://g.gravizo.com/source/svg?https://gist.githubusercontent.com/reyoung/d976f3c8b1a081eb0b2e6ae02dd8213e/raw/829511efb9da13b2708a3fdde038292cbe7e0ff3/g2.dot)

如上图所示，Leader还是A，每个team member的沟通时间我们还是认为每天一个小时。那么Leader A每天要花8个小时沟通。如果按照每天工作时间8小时来算，A的工作就完事了。这是简单算数，但是实际情况会更加悲惨。

A同学也是一个热爱编程的同事，常年累月的沟通让他心情非常不好。心情不好的A在沟通效率上也越来越差，导致新的同事总觉得自己不受重视。其实，A同学的时间，完成本职工作就已经很紧张了，没有余力在做`social connect`。所以，大家会感觉到team内的人情好淡漠啊，大家就只谈工作。我这工作有困难，都没有人体谅一下。

于是A同学越来越不开心。同时可以看出来这个图是单点依靠的，有一天A身体终于扛不住了，一休假。或者直接说，我不干了，离职了。大家就都不开心了。因为没有人带领了。

所以，在这个时期，Leader A本质上是一个英雄， BCDEFGHI同学都是士兵(魔兽争霸我玩的还可以=_=)。

但是对于我们，本身上是开发分布式机器学习系统的人，沟通为什么要这么**集中式**呢？所以我们开始玩起了自组织(P2P)的团队沟通。也就是每个人为每个人自己的工作负责，每个人每周和大家汇报一下进展就好了。当然，自组织的时候，我们之间也是有合作的。但是可以是小范围的合作。那么我们的沟通关系就变成了这样。

![middle team 2](https://g.gravizo.com/source/svg?https://gist.githubusercontent.com/reyoung/d976f3c8b1a081eb0b2e6ae02dd8213e/raw/829511efb9da13b2708a3fdde038292cbe7e0ff3/g3.dot)

我们变成了一个一个的小团体，每个小团体之间沟通比较多，然后大家还是为了项目的一个主线来努力。这一阶段又变得比较稳定了。一来是，没有了特别强力的Leader A作为单点，所以就不会有单点依赖。二来是，整体团队的沟通成本变小了，我们的沟通也方便了。有什么事情，只要和大家说一声，这个事我做了，大家也都没意见，我们就可以接着往下做下去了。

### 中型团队的沟通问题

之前的中型团队沟通我们已经解决了。但是，其实那个沟通方式有一个根本性的问题，就是虽然沟通成本下来了，大家可以专心工作。但是，新人非常难以融入。因为随着沟通的深入，几个熟悉的人之间必然有着一定的默契，做的事情也必然有一定因果关系。这就导致了，A不理解H在做什么，H也不知道A为什么要这么做。

![middle team 2](https://g.gravizo.com/source/svg?https://gist.githubusercontent.com/reyoung/d976f3c8b1a081eb0b2e6ae02dd8213e/raw/829511efb9da13b2708a3fdde038292cbe7e0ff3/g4.dot)

如上图所示，"新人J" 很难融入这个团队。因为大家已经有了固有的习惯。

同时，这个中型团队的沟通模型还是有一个非常大的问题，就是沟通成本降下来了，沟通时间效率还是太低。具体表现为

* 项目的时间上，经常有人会提出一个想法，放了几个月，然后再提。大家其实也都忘了。
* 几个人要一起讨论一个事情，这要求这几个人在时间和空间上都要同步。也就是某个时间，大家都要有时间。但是，往往有一些事情都会让大家同步，我们就陷入了类似于`SGD`的同步barrier中。同时，每个人每天的状态都不一样，我们团队有美国，北京，上海。三个地方也有一些时差。所以，这种同步barrier最后就是非常悲惨的。

## 大型团队的沟通问题

随着Paddle的开源，我们的参与人数变得更多了。很多公司外部的人，部门外部的人都会贡献东西。要么是贡献代码，要么是贡献问题。每天的贡献量都在十几个甚至几十个。那我们自组织的形式怎么沟通？？

中型团队沟通的问题是大家非常习惯于内部的，小范围的沟通。大家有自己的沟通习惯。但是，其实这种沟通方式，已经把我们耦合在了一起。虽然对于一个小系统，耦合性强也是有好处的。比如沟通速度快。但是对于一个大系统，我们还是要做一个低耦合的事情，这样我们才能根本上从沟通的繁杂中解脱出来。

有一个名人说过，没有一个耦合问题是不能靠引入一个中间层解决的。

所以，其实文档就是我们的中间层。如果我们把大型团队的所有沟通，比如我想如何做这个事情，这个事情我有什么困难了，全公开的放到一个文档中，我们其实就只用和"文档"沟通工作了。

![large team](https://g.gravizo.com/source/svg?https://gist.githubusercontent.com/reyoung/d976f3c8b1a081eb0b2e6ae02dd8213e/raw/829511efb9da13b2708a3fdde038292cbe7e0ff3/g5.dot)

这样，我们把讨论的过程放到了文档中，这个好处是\:
* 解耦合大家的时间\: 从SGD到AsyncSGD。我和别人沟通的时间，可以由我自己来掌控了。并不需要谁谁谁一句话，我就要和他聊。谁谁谁另一句话，我就要和另一个人聊。
* 让新人可以加入\: 我们再也没有封闭的圈子了，新人也不需要知道很多前因后果，只要看文档就可以了。

即使如此，我们还是一个Team。我们将悲惨繁杂的沟通工作，使用中间件"文档"进行解耦。我们便有了更多时间做自己的事情，无论是coding还是线下情感交流，甚至哪怕是避免无谓的开会，能够有更多的时间自娱自乐也是好的。

# 另一些相关的事情

变成以文档为中心的沟通后，我们其实有另一些之前没有的问题出现了。这里我也简单的描述一下。

* 谁是英雄谁是兵: 从中型团队开始，我们的团队就没有中间单点的Leader概念了。本质上，所有的『活/任务』，每个人开始做的事情，都不应该是因为是『谁谁谁』觉得这个事情有意思，而开始做。而是『我』觉得这个事情有意思，而开始做。从这个角度来说，我们每个人都是英雄。当然，每个人也都是兵。

 * 没有任何一个人是『领导』别人的。同时，每一个人都可以让另一个人『帮助』。
  
   * Could you help me to do this? / Could you help me to do that?
   
 * 每一个人都有每一个人的长处。我想做XXX的开发，只要大框架上没有什么影响和非常紧急需要帮助的事情，我们也都可以做XXX开发。
   
* 谁来指导我，让我成长: 在以文档为中心的沟通开始之后，我们做一个事情或者让别人帮助做一个事情之前，我们都要写一个『我怎么做』这个事情的文档。然后增加一个特别的issue标签，例如 need be discussed。这样，大家根据这个文档，来了解这个事情，讨论这个事情。随着事情被讨论，自己也会成长。
   
 * 也就是每一个人都是我的老师，每一个人都可以指导我成长。

* 我在github上回复一句，他能看懂: 这个就是一个更大的问题了。本质上在团队内部，我们可能A和B的沟通，直接用线上聊天工具就可以了。或者，即使是回issue，那我只要让对方听懂我在说什么就可以了。
   
 * 简单的说这样是不行的。为什么呢？因为使用文档，就是要解耦这种小团队的习惯，为了让更多的人了解这个事情是什么。这样做的好处是\:
      
     * 我们把文档写的尽量明白，并不是为了和对方沟通，而是为了让一个新人能够在基本上不了解Paddle的时候就能够读懂。并且可以参与讨论。这样，我们的团队才能扩张。
     * 我们把issue回复的尽量全面，这样就可以让新的用户发现同样问题的时候，直接再给这个新用户贴老的issue的地址，让他能够快速了解这个问题。

* 有写文档的功夫，我早就做完了，没必要写文档: 确实很多事情会这样。所以这也要掌握一个度。不是事事都要写文档，也不是事事都不用写文档。我觉得这个度就是，如果我要做系统A，如果我哪天离职了，或者生病了，其他人可以根据我的文档，接手继续完成这个系统。就好。

